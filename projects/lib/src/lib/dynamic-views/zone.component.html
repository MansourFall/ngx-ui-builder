<ng-container
  *ngTemplateOutlet="isArray ? array : single; context: { $implicit: data }"
>
</ng-container>

<!-- data is an array -->
<ng-template #array let-data>
  <ng-container *ngFor="let d of data; let i = index">
    <ng-container
      *ngTemplateOutlet="single; context: { $implicit: d, index: i }"
    >
    </ng-container>
  </ng-container>
</ng-template>

<!-- data is a single object -->
<ng-template #single let-data let-index="index">
  <ng-container [uib-code]="id" [data]="data">
    <div
      *ngIf="!isTemplate(id)"
      #ref

      uib-configurable
      [uib-item]="id"
      [id]="id"
      [zone]="id"
      [templates]="templates"
      [enableContainers]="enableContainers"

      [data]="data"
      [dataIndex]="index"

      [dndDropzone]="[id]"
      [dndHorizontal]="ref.isHorizontal()"
      [dndDisableDropIf]="index > 0"
      (dndDrop)="onDndDrop($event)"
    ></div>
  </ng-container>
</ng-template>
