<div #offcanvas class="offcanvas offcanvas-end" tabindex="-1" id="offcanvas" *ngIf="{edited: (edited$ | async)} as obs">
  <!-- HEADER -->
  <div class="offcanvas-header bg-light border-bottom">
    <h5 class="offcanvas-title" *ngIf="!_showTree && obs.edited">
      <strong>{{obs.edited.config.id}}</strong>
      <br/>
      <h6>(Type: <strong>{{obs.edited.config.type}}</strong>)</h6>
    </h5>
    <h5 class="offcanvas-title" *ngIf="_showTree">Configuration Tree</h5>

    <button type="button" class="btn ms-auto" [ngClass]="_showTree? 'btn-primary' : 'btn-link'" uib-tooltip="{{_showTree? 'Hide' : 'Show'}} configuration tree" (click)="showTree(!_showTree)">
      <svg-icon key="tree" width="22px" height="25px"></svg-icon>
    </button>
    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>

  <div #offcanvasBody class="offcanvas-body">
    
    <ng-container *ngIf="!_showTree && obs.edited">
      <!-- CONFIGURATOR -->
    
      <ng-container
        *ngTemplateOutlet="configurators[obs.edited.config.type]?.template; context: { $implicit: obs.edited }">
      </ng-container>
  
      <ng-container *ngIf="showPalette && obs.edited.config.type === '_container'">
        <details class="mb-3" open>
          <summary>Component palette (drag & drop)</summary>
          <uib-palette [context]="obs.edited.context" [configurators]="obs.edited.configurators"></uib-palette>
        </details>
    
        <details class="mb-3" open *ngIf="showFlexEditor">
          <summary>Layout</summary>
          <uib-flex-editor [config]="obs.edited.config"></uib-flex-editor>
        </details>
      </ng-container>      
      
      <uib-html-editor *ngIf="showHtmlEditor && obs.edited.config.type === '_raw-html'"
        [context]="obs.edited"
        class="d-block mb-3">
      </uib-html-editor>
  
      <div class="mb-3" *ngIf="showCssClasses">
        <uib-class-editor [context]="obs.edited"></uib-class-editor>
      </div>
  
      <details [attr.open]="obs.edited.config.condition? '' : undefined" class="mb-3" *ngIf="showConditionalDisplay && obs.edited.context.data">
        <summary uib-tooltip="Display this component only if the data validates a rule">Conditional display</summary>
        <uib-condition-editor [config]="obs.edited.config"></uib-condition-editor>
      </details>
      
      <div class="d-flex justify-content-start mb-1">
        <button class="btn btn-outline-danger me-2"
          (click)="remove(obs.edited.context)"
          uib-tooltip="Remove this component from its parent"
          *ngIf="showRemove && obs.edited.context.parentId"
        >
          Remove
        </button>
        <button class="btn btn-outline-secondary"
          (click)="duplicate(obs.edited.context)"
          uib-tooltip="Duplicate this component within its parent"
          *ngIf="showDuplicate"
        >
          Duplicate
        </button>
      </div>
    </ng-container>
    
    <uib-tree [configuration]="configuration" *ngIf="_showTree"></uib-tree>
      
  </div>
</div>
